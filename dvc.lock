schema: '2.0'
stages:
  prepare_dataset:
    cmd: python cml_scripts/prepare_dataset.py
    deps:
    - path: cml_scripts/prepare_dataset.py
      md5: 9c4238918baa3417ce5bfc7cfd346035
      size: 498
    - path: data/data.csv.gz
      md5: b44d756899b65b1f2423aa038f741e49
      size: 996189061
    outs:
    - path: data/sequences.pickle
      md5: 90cb0b7cfd76ceb2732227fe4f5aa1fa
      size: 812893524
  train_model:
    cmd: python -m cml_scripts.train_model
    deps:
    - path: cml_scripts/train_model.py
      md5: a8661a6510b3206c01894315d3cd350f
      size: 1699
    - path: data/sequences.pickle
      md5: 90cb0b7cfd76ceb2732227fe4f5aa1fa
      size: 812893524
    params:
      params.yaml:
        dataloader.num_workers: 0
        project_name: Recommendation-With-Transformers
        train.batch_size: 256
        train.epochs: 5
        train.train_size_ratio: 0.9
    outs:
    - path: checkpoints/
      md5: cbb7b6f4cf49f86e4ad718f6ec575b22.dir
      size: 107372831
      nfiles: 1
  save_model_from_last_checkpoint_as_state_dict:
    cmd: PYTHONPATH=. python cml_scripts/save_model_from_last_checkpoint_as_state_dict.py
    deps:
    - path: checkpoints/
      md5: bafa02ff4904e2e3dac7131c9dedb68a.dir
      size: 107373309
      nfiles: 1
    params:
      params.yaml:
        best_model_save_path: model_state_dicts/bert_model.pth
        checkpoints_dir: checkpoints/
        dataloader:
          num_workers: 0
        train.epochs: 1
    outs:
    - path: model_state_dicts/bert_model.pth
      md5: b68a322b457bd8090ff663f76b33dd2c
      size: 35796873
  validate_baseline_model:
    cmd: python -m cml_scripts.evaluate_baseline_metrics
    deps:
    - path: cml_scripts/evaluate_baseline_metrics.py
      md5: 28032becee9d8138dc5540db78f2aaf5
      size: 939
    params:
      params.yaml:
        baseline.n_neighbors: 100
        project_name: Recommendation-With-Transformers
        train.train_size_ratio: 0.9
    outs:
    - path: cml_scripts/baseline_metrics.json
      md5: c9c05ddd72f9e7cce2c4aaa93c0fea1b
      size: 96
  validate_model:
    cmd: python -m cml_scripts.evaluate_metrics
    deps:
    - path: cml_scripts/evaluate_metrics.py
      md5: d86fb7c794fbe753e250209cbb72bcfe
      size: 1857
    params:
      params.yaml:
        dataloader.num_workers: 0
        project_name: Recommendation-With-Transformers
        train.batch_size: 256
        train.epochs: 5
        train.train_size_ratio: 0.9
    outs:
    - path: cml_scripts/transformer_metrics.json
      md5: 50718d0a9a3446693b792ad8120bb978
      size: 102
  train_neighbours_model:
    cmd: python -m cml_scripts.train_neighbours_model
    deps:
    - path: cml_scripts/train_neighbours_model.py
      md5: a7dab5d732c9a7e8f07b5139415efd41
      size: 1582
    - path: data/train_data.pickle
      md5: c43a7a486ab37f0b5282d69d9fe6c15c
      size: 628254102
    - path: data/val_data.pickle
      md5: 78b31171fcf7f6f0673f6b8344e4fb85
      size: 75216526
    params:
      params.yaml:
        dataloader.num_workers: 0
        neighbours_checkpoints_dir: checkpoints_neighbours/
        project_name: Recommendation-With-Transformers
        train_neighbours.batch_size: 512
        train_neighbours.epochs: 100
    outs:
    - path: checkpoints_neighbours/
      md5: d80a84315035cafed62daa2493f267b5.dir
      size: 16569527
      nfiles: 1
  validate_neighbours_model:
    cmd: python -m cml_scripts.evaluate_neighbours_model_metrics
    deps:
    - path: cml_scripts/evaluate_neighbours_model_metrics.py
      md5: cde704b7b49b4440aab3d39dc71830a0
      size: 1646
    params:
      params.yaml:
        dataloader.num_workers: 0
        neighbours_checkpoints_dir: checkpoints_neighbours/
        project_name: Recommendation-With-Transformers
        train_neighbours:
          epochs: 100
          batch_size: 512
    outs:
    - path: cml_scripts/neighbours_metrics.json
      md5: 8f53fb547be7446caf11dae69dfc8e05
      size: 100
